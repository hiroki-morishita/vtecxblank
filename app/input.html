<div id="messeage_s" style="color: green; display: none;"></div>
<div id="messeage_e" style="color: red;" display: none;></div>
<h3>ユーザ情報登録</h3>
<form>
	<div class="form-group">
		<label for="id">id</label>
		<input type="text" class="form-control" id="id" placeholder="id">
		<label for="email">email</label>
		<input type="text" class="form-control" id="email" placeholder="email">
	</div>
</form>
<br />
<h4>お気に入りのもの</h4>
<form>
	<div class="form-group">
		<label for="food">好きな食べ物</label>
		<input type="text" class="form-control" id="food" placeholder="food">
		<label for="music">好きな音楽</label>
		<input type="text" class="form-control" id="music" placeholder="music">
	</div>
</form>
<br />
<h4>趣味</h4>
<button class="btn btn-default" id="add_list"><i class="glyphicon glyphicon-plus"></i></button>
<table class="table" id="hobby">
	<thead>
		<tr>
			<th>タイプ</th>
			<th>名前</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>
<button type="button" id="add" class="btn btn-default">登録</button>
<script>
	$(function(){

		setHobbyList();
		
		$('#add').click(function(){
			
			$('#messeage_s, #messeage_e').hide();
			
			var data = {'feed': {'entry': []}};
			var inputData = {};
			var userData = {
				'id': parseInt($('#id').val()),
				'email': $('#email').val()
			}
			var favoriteData = {
				'food': $('#food').val(),
				'music': $('#music').val()
			};
			var hobbyData = getHobbyData();
			inputData.userinfo = userData;
			inputData.favorite = favoriteData;
			inputData.hobby = hobbyData;
			data.feed.entry.push(inputData);

			$.ajax({
				url: '/d/registration',
				method: 'post',
				dataType: 'json',
				data: JSON.stringify(data)
			}).done(function( res ) {
				$('#messeage_s').show().html('登録に成功しました。一覧で確認してください。');
			}).fail(function( jqXHR, textStatus, errorThrown ) {
				$('#messeage_e').show().html('登録に失敗しました。\nエラーメッセージ：' + jqXHR.responseText);
			});
			
			return false;
		});
	});
	// 趣味一覧初期処理
	function setHobbyList(){
		var hobbyTepmTr = '<tr>'+
			'<td><select class="form-control"><option></option><option>屋内</option><option>屋外</option><option>その他</option></select></td>'+
			'<td><input type="text" class="form-control"></td>'+
		'</tr>';
		$('#hobby').find('tbody').html(hobbyTepmTr);
		$('#add_list').click(function(){
			$('#hobby').find('tbody').append(hobbyTepmTr);
		});
	}
	// 趣味情報の取得
	function getHobbyData() {
		var array = [];
		var $list = $('#hobby').find('tbody').find('tr');
		for (var i = 0, ii = $list.length; i < ii; ++i) {
			var typeVal = $list.eq(i).find('select').val();
			var nameVal = $list.eq(i).find('input[type="text"]').val();
			if (typeVal) {
				array.push({'type': typeVal, 'name': nameVal});
			}
		}
		return array;
	}
	
</script>